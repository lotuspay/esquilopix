import{r as o,j as s,H as O}from"./app-ISxEiS1S.js";import{A}from"./AgentPanelModal-DQL6vaSx.js";import{D as F,P as L,A as R}from"./AuthModal-C92geU3j.js";import{H as q}from"./HelpModal-CCSZe4Ch.js";import"./app-DEV1gfeS.js";function Z({user:t,isAuthenticated:c,settings:T}){const[d,i]=o.useState(t??null),[g,M]=o.useState(!!c),[S,m]=o.useState(!1),[y,u]=o.useState(!1),[x,f]=o.useState(!1),[E,h]=o.useState(!1),[b,w]=o.useState(!1);let r=null;o.useRef(null),o.useEffect(()=>{i(t??null)},[t]),o.useEffect(()=>{M(!!c)},[c]);const W=o.useCallback(async()=>{if(!g)return null;try{const{data:e}=await axios.get("/api/user/refresh");if(e?.success&&e?.user)return e.user}catch{}return null},[g]);o.useEffect(()=>{window.addEventListener("message",function(e){e.origin===window.location.origin&&(e.data.data=="request_auth"?c?p():m(!0):e.data.data=="open_profile"?u(!0):e.data.data=="open_rules"?h(!0):e.data.data=="open_deposit"?f(!0):e.data.type=="match_start"?I(e.data.data):e.data.type=="match_collect"?j():e.data.data=="open_share"?w(!0):e.data.type=="chest_open"&&B(e.data.data),console.log("Recebido do iframe:",e.data))})},[]);const B=async e=>{try{const a=await axios.post("/game/open-chest",{game_id:r,chest_index:e});if(a.data.success){const{chest_content:n,is_fox:l,multiplier:U,bonus_multiplier:z,total_winnings:P,game_over:G,all_results:J}=a.data;console.log("Backend response:",a.data),console.log("Total winnings from backend:",P);let _=a.data;_.chest_index=e,document.getElementById("game-iframe").contentWindow.postMessage({action:"chest_receive",data:_},window.location.origin)}}catch(a){document.getElementById("game-iframe").contentWindow.postMessage({action:"chest_allow_click",data:""},window.location.origin),console.error("Error opening chest:",a)}},j=async()=>{try{const e=await axios.post("/game/cash-out",{game_id:r});r=null,t=await W(),i(t),document.getElementById("game-iframe").contentWindow.postMessage({action:"refresh_balance",data:t.balance},window.location.origin)}catch(e){console.error("Error cashing out:",e)}},I=async e=>{try{const a=await axios.post("/game/start",{amount:e}),n=document.getElementById("game-iframe");if(a.data.success){let l=a.data.game.user_balance;r=a.data.game.id,l=parseFloat(l).toFixed(2),n.contentWindow.postMessage({action:"match_start",data:l},window.location.origin)}}catch(a){const n=document.getElementById("game-iframe");n&&n.contentWindow&&n.contentWindow.postMessage({action:"gameboard_reset",data:t},window.location.origin),f(!0),console.error("Error starting game:",a)}},p=()=>{const e=document.getElementById("game-iframe");e&&e.contentWindow&&e.contentWindow.postMessage({action:"auth_info",data:t},window.location.origin)},C=e=>{t=e,i(e),document.getElementById("game-iframe").contentWindow.postMessage({action:"refresh_balance",data:t.balance},window.location.origin)},k=e=>{t=e,c=!0,i(e),m(!1),p()},D=e=>{i(e),t=e,document.getElementById("game-iframe").contentWindow.postMessage({action:"refresh_balance",data:t.balance},window.location.origin)},H=e=>{console.log("Withdrawal success, updating user:",e),t=e,i(e),document.getElementById("game-iframe").contentWindow.postMessage({action:"refresh_balance",data:t.balance},window.location.origin)};return s.jsxs(s.Fragment,{children:[s.jsx(O,{title:"EsquiloMania"}),s.jsx(A,{isOpen:b,onClose:()=>w(!1),user:d,onUserUpdate:D}),s.jsx(q,{onClose:()=>h(!1),isOpen:E}),s.jsx(F,{isOpen:x,onClose:()=>f(!1),user:d,onSuccess:C}),s.jsx(L,{isOpen:y,onClose:()=>u(!1),user:d,playButtonClickSound:console.log(""),onWithdrawalSuccess:H}),s.jsx(R,{show:S,onClose:()=>m(!1),onSuccess:k,hidePhoneLogin:!0}),s.jsx("iframe",{id:"game-iframe",src:"/storage/index.html",style:{border:0,width:"100%",height:"100%",overflow:"hidden",position:"fixed",top:0,left:0}})]})}export{Z as default};
